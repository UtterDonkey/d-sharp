import f from"@ampproject/remapping";import{SKIP as d,walk as y}from"astray";import x from"magic-string";import{parse as M}from"meriyah";import{mkdir as h,writeFile as w}from"node:fs/promises";import{dirname as T,extname as E}from"node:path";var S=new TextEncoder,O=new TextDecoder,l=e=>S.encode(e),u=e=>O.decode(e);function b(e,i){let t=e.replace(/\s+/gm," ").replace(/> </g,"><").replace(/^ </g,"<").replace(/> $/g,">").replace(/> #(\w+) </g,">#$1<");return i||(t=t.replace(/<!--.*?-->/gs,"")),t}function k(e,i={}){let t=new x(e),p=[],a=M(e,{next:!0,loc:!0,ranges:!0,module:!0,onComment(r,n,o,m,s){r==="MultiLine"&&n.trim()==="! minify-templates-ignore"&&p.push(s.end.line+1)}});return y(a,{TemplateLiteral(r){var n,o;return p.includes(r.loc.start.line)||i.taggedOnly&&((o=(n=r.path)==null?void 0:n.parent)==null?void 0:o.type)!=="TaggedTemplateExpression"?d:void 0},TemplateElement(r){let{start:n,end:o}=r.loc;(n.line!==o.line||n.column!==o.column)&&t.overwrite(r.start,r.end,b(r.value.raw,i.keepComments))}}),t}var I=(e={})=>({name:"minify-templates",setup(i){i.initialOptions.write===!1&&i.onEnd(t=>{var p;(p=t.outputFiles)==null||p.forEach((a,r,n)=>{if(E(a.path)!==".js")return;let o=u(a.contents),m=k(o,e);n[r].contents=l(m.toString());let s=n.findIndex(c=>c.path===`${a.path}.map`);if(s>-1){let c=n[s],g=f([{...m.generateDecodedMap({source:a.path,file:c.path,hires:!0}),version:3},u(c.contents)],()=>null);n[s].contents=l(g.toString())}})})}}),K=()=>({name:"write-files",setup(e){e.initialOptions.write===!1&&e.onEnd(async i=>{i.outputFiles&&await Promise.all(i.outputFiles.map(t=>h(T(t.path),{recursive:!0}).then(()=>w(t.path,t.contents,"utf8"))))})}});export{u as decodeUTF8,l as encodeUTF8,k as minify,I as minifyTemplates,b as stripWhitespace,K as writeFiles};
//# sourceMappingURL=index.mjs.map
